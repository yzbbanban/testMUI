<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<script type="text/javascript" charset="utf-8">
			mui.init();
		</script>
		
	</head>

	<body>
		<a href="javascript:void(0);" class="imageup">上传图片</a>
		<img src="2.jpg" alt="" id="headimg" />
		<script>
			function plusReady() {
				// 弹出系统选择按钮框  
				mui("body").on("tap", ".imageup", function() {
					page.imgUp();
				})
			}
			var page = null;
			page = {
				imgUp: function() {
					var m = this;
					plus.nativeUI.actionSheet({
						cancel: "取消",
						buttons: [{
								title: "拍照"
							},
							{
								title: "从相册中选择"
							}
						]
					}, function(e) { //1 是拍照  2 从相册中选择  
						switch(e.index) {
							case 1:
								clickCamera();
								break;
							case 2:
								clickGallery();
								break;
						}
					});
				}
				//摄像头  
			}

			//发送照片  

			function clickGallery() {
				plus.gallery.pick(function(path) {
					console.log("clickGallery-----> " + path);
					
					plus.io.resolveLocalFileSystemURL(path, function(entry) {
						var localUrl = entry.toLocalURL();
						document.getElementById("headimg").src = path; 
						console.log("clickGallery-----> " + localUrl);
						plus.zip.compressImage({
							src: localUrl,
							dst: "_doc/chat/gallery/" + localUrl,
							quality: 20,
							overwrite: true
						}, function(e) {
							console.log("clickGallery-----> " + e);
						}, function(err) {
							console.log("压缩失败：  " + err.message);
						});
						
						
					});

				}, function(err) {});
			};

			// 拍照  

			function clickCamera() {
				var cmr = plus.camera.getCamera();
				var res = cmr.supportedImageResolutions[0];
				var fmt = cmr.supportedImageFormats[0];
				cmr.captureImage(function(path) {
					alert("clickCamera");
					//plus.io.resolveLocalFileSystemURL(path, function(entry) {  
					plus.io.resolveLocalFileSystemURL(path, function(entry) {
						var localUrl = entry.toLocalURL();
						document.getElementById("headimg").src = localUrl; 
						console.log("-----> " + localUrl);
						plus.zip.compressImage({
							src: localUrl,
							dst: "_doc/chat/camera/" + localUrl,
							quality: 20,
							overwrite: true
						}, function(e) {
							console.log("-----> " + e);
						}, function(err) {
							console.log("压缩失败：  " + err.message);
						});
					});
				}, function(err) {
					console.error("拍照失败：" + err.message);
				}, {
					index: 1
				});
			};

			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener("plusready", plusReady, false);
			}
		</script>
	</body>

</html>